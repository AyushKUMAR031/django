## 🍪 Unit VI - Cookies, Sessions, and Authentication

### 1. Create and manage cookies
* Cookies are small pieces of data that websites store on a user's browser.
* They are used to remember information about the user, such as their login status, preferences, or items in a shopping cart.
* In Django, you can set a cookie on the `response` object and read it from the `request` object.
* Cookies are not secure by themselves, but useful for temporary data.

```python
# views.py
from django.http import HttpResponse

# setting cookie
def set_cookie(request):
    response = HttpResponse("Cookie Set")
    response.set_cookie('name', 'Itachi', max_age=3600)  # expires in 1 hour
    return response

# reading or getting cookie
def get_cookie(request):
    name = request.COOKIES.get('name')  # safely fetch
    return HttpResponse(f"Hello {name}")

# set_cookie(key, value, max_age) → creates a cookie
# request.COOKIES → dictionary-like, used to get cookies

```
* helps in remembering user preference (theme,language), short term info -> username, id, (not password).

---

### 2. Work with sessions in Django
* Sessions are used to store data on the server-side for a particular user's related session ID.
* Django uses a session ID stored in a cookie to identify the user's session.
* The session data is stored in the database by default.(so more secure cause its in db, not in browser, we only have sessionID).

**Enabling sessions:**
* Sessions are enabled by default in `settings.py` through the `django.contrib.sessions` app and middleware.
* Ensure `django.contrib.sessions.middleware.SessionMiddleware` is in settings.py -> MIDDLEWARE.

    ```python

    # views.py
    from django.http import HttpResponse

    def set_session(request):
        request.session['username'] = 'Itachi'
        return HttpResponse("Session Set")

    def get_session(request):
        username = request.session.get('username', 'Guest')
        return HttpResponse(f"Hello {username}")

    # request.session['key'] = value → sets session
    # request.session.get('key', default) → retrieves session safely
    # Sessions auto-expire (can configure in settings.py)

    ```

* used for login, storing data across diff request (shopping cart).

    ```python

    # for session expire write any of these in settings.py

    # Time (in seconds) before session expires
    SESSION_COOKIE_AGE = 1209600  # default = 2 weeks (in seconds)

    # If True, session expires when browser closes
    SESSION_EXPIRE_AT_BROWSER_CLOSE = False  

    # Save session to database on every request (not only when modified)
    SESSION_SAVE_EVERY_REQUEST = False  

    ```

---

### 3. Create and manage Users
* Django comes with a built-in user authentication system.
* The `django.contrib.auth` app provides models for users, groups, and permissions.

**Creating a superuser:**
* You can create a superuser to access the Django admin site.
    ```bash
    python manage.py createsuperuser
    ```

**Creating users programmatically:**
-   ```python
        from django.contrib.auth.models import User

        user = User.objects.create_user('newuser', 'newuser@example.com', 'password123')
        user.first_name = 'New'
        user.last_name = 'User'
        user.save()

        # or 

        from django.contrib.auth.models import User

        # Create user
        user = User.objects.create_user(username='itachi', password='sharingan123', email='itachi@uchiha.com')

        # Superuser (admin)
        superuser = User.objects.create_superuser(username='admin', password='admin123', email='admin@site.com')
    ```

**Managing User**
* Through Admin Panel (create, edit, delete users).
* Programmatically using Django ORM.

---

### 4. Implement login and logout
* Django provides views for handling login and logout.

**Login:**
* The `django.contrib.auth.views.LoginView` can be used to display a login form and handle user authentication.

*urls.py:*
```python
from django.contrib.auth import views as auth_views

urlpatterns = [
    path('login/', auth_views.LoginView.as_view(template_name='login.html'), name='login'),
]
```

*login.html:*
```html
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Login</button>
</form>
```

**Logout:**
* The `django.contrib.auth.views.LogoutView` handles logging the user out.

*urls.py:*
```python
from django.contrib.auth import views as auth_views

urlpatterns = [
    path('logout/', auth_views.LogoutView.as_view(next_page='home'), name='logout'),
]
```

---

### 5. Use Django login in views
* You can protect views so that they are only accessible to logged-in users using the `@login_required` decorator.

```python
from django.contrib.auth.decorators import login_required

@login_required
def protected_view(request):
    return HttpResponse(f"Hello, {request.user.username}! This is a protected view.")
```
* If a user who is not logged in tries to access this view, they will be redirected to the login page.

---