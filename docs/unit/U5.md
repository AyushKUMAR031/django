# Unit 5: Models, Migrations, and Django Admin

*Delve into the database layer—define models, perform database migrations, manage data with the ORM, and use Django’s powerful admin interface.*

- [ ] Create Django models
- [ ] Work with migrations
- [ ] Use the Django shell (Insert, Update, Delete)
- [ ] Understand Django ORM basics
- [ ] Define and use foreign keys in models
- [ ] Use the Django Admin interface
- [ ] Add groups and users via Admin
- [ ] Set up user permissions in Admin
- [ ] Configure and set up the database

---

## Notes

### 1. Create Django Models

A Django model is a Python class that represents a database table. It's the single, definitive source of information about your data.

-   **Defining a Model:**
    -   Models are defined in your app's `models.py` file.
    -   Each model is a class that inherits from `django.db.models.Model`.
    -   Each attribute of the class represents a database field (e.g., `CharField`, `IntegerField`, `DateTimeField`).
    -   Example:
        ```python
        from django.db import models

        class Student(models.Model):
            first_name = models.CharField(max_length=30)
            last_name = models.CharField(max_length=30)
            email = models.EmailField()
        ```

-   **Registering the App:**
    -   To include the app in your project, add its configuration class to the `INSTALLED_APPS` list in your project's `settings.py`.

### 2. Work with Migrations

Migrations are Django's way of propagating changes you make to your models into your database schema.

-   **Creating Migrations:**
    -   Run `python manage.py makemigrations` to create new migration files based on the changes in your models.
-   **Applying Migrations:**
    -   Run `python manage.py migrate` to apply the migrations to your database.
-   **Viewing SQL:**
    -   Run `python manage.py sqlmigrate <app_name> <migration_name>` to see the SQL statements for a migration.
-   **Listing Migrations:**
    -   Run `python manage.py showmigrations` to see all migrations and their status.

### 3. Use the Django Shell

The Django shell is an interactive Python console for your Django project.

-   **Starting the Shell:**
    -   Run `python manage.py shell`.
-   **Interacting with the Database:**
    -   You can import your models and use the ORM to create, retrieve, update, and delete objects.
    -   Example:
        ```python
        from apps.studentManager.models import Student

        # Create a new student
        student = Student(first_name='John', last_name='Doe', email='john.doe@example.com')
        student.save()

        # Get all students
        students = Student.objects.all()

        # Filter students
        students = Student.objects.filter(last_name='Doe')

        # Get a single student
        student = Student.objects.get(id=1)

        # Delete a student
        student.delete()
        ```

### 4. Understand Django ORM Basics

The Object-Relational Mapper (ORM) allows you to interact with your database using Python code instead of SQL.

-   **Querying Data:**
    -   `all()`: Retrieve all objects.
    -   `filter()`: Retrieve a subset of objects.
    -   `get()`: Retrieve a single object.
-   **Lazy Evaluation:** QuerySets are lazy. They don't hit the database until they are evaluated.

### 5. Define and Use Foreign Keys in Models

A `ForeignKey` creates a many-to-one relationship between models.

-   **Defining a Foreign Key:**
    -   Use `models.ForeignKey` in your model.
    -   The first argument is the "parent" model.
    -   The `on_delete` argument specifies what happens when the parent object is deleted (e.g., `models.CASCADE`, `models.PROTECT`, `models.SET_NULL`).
    -   Example:
        ```python
        from django.db import models

        class Course(models.Model):
            name = models.CharField(max_length=100)

        class Enrollment(models.Model):
            student = models.ForeignKey(Student, on_delete=models.CASCADE)
            course = models.ForeignKey(Course, on_delete=models.CASCADE)
        ```

### 6. Use the Django Admin Interface

Django provides a built-in admin interface for managing your site's content.

-   **Enabling the Admin:**
    -   Ensure `'django.contrib.admin'` is in `INSTALLED_APPS`.
    -   Include the admin URLs in your project's `urls.py`.
-   **Registering Models:**
    -   Register your models in your app's `admin.py` file to make them editable in the admin.
    -   Example:
        ```python
        from django.contrib import admin
        from .models import Student

        admin.site.register(Student)
        ```
-   **Customization:**
    -   You can customize the admin interface to control how your models are displayed.

### 7. Add Groups and Users via Admin

Django's authentication system includes `User` and `Group` models.

-   **Users:** Individual accounts with permissions.
-   **Groups:** A way to categorize users and apply permissions to them collectively.
-   You can manage users and groups through the Django admin interface.

### 8. Set Up User Permissions in Admin

Django has a built-in permission system.

-   **Default Permissions:** Django automatically creates `add`, `change`, `delete`, and `view` permissions for each model.
-   **Assigning Permissions:** You can assign permissions to users or groups in the admin interface.

### 9. Configure and Set Up the Database

-   **Database Configuration:**
    -   The `DATABASES` dictionary in `settings.py` contains the database settings.
-   **Supported Databases:**
    -   Django supports SQLite, PostgreSQL, MySQL, and Oracle.
-   **Applying Initial Migrations:**
    -   Run `python manage.py migrate` to create the necessary tables for Django's built-in apps.